<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Создание тура — макет</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: '#bada27',
            brandDark: '#a2c113',
            ui: {
              bg: '#f3f4f6',
              card: '#ffffff',
              field: '#f6f7fb',
              border: '#e6e7eb',
              text: '#1f2937',
              mute: '#6b7280',
            }
          },
          boxShadow: { subtle: '0 2px 10px rgba(17,24,39,.05)' },
          borderRadius: { 'xl2': '16px' },
          fontSize: { h1: '28px' }
        }
      }
    }
  </script>
  <style>
    .field-like{background:#f6f7fb}
    .card-edge{border:1px solid #e6e7eb}
    .ring-muted:focus{outline:none;box-shadow:0 0 0 3px rgba(59,130,246,.15)}
    .text-13{font-size:13px;line-height:1.4}
    .text-15{font-size:15px;line-height:1.5}
    .nav-active{border-left:4px solid #bada27;background:#f9fafb;font-weight:600}
    .tip{background:#f1f8dd;border:1px solid #e0efb6;color:#5a6b1b}
    /* ровный toggle */
    .toggle-switch{position:relative;display:inline-flex;align-items:center}
    .toggle-switch input{position:absolute;inset:0;opacity:0}
    .toggle-switch .track{
      width:46px;height:26px;border-radius:9999px;background:#e5e7eb;
      display:inline-flex;align-items:center;padding:3px;transition:.2s ease;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
    }
    .toggle-switch .thumb{
      width:20px;height:20px;border-radius:9999px;background:#fff;transition:.2s ease;box-shadow:0 1px 2px rgba(0,0,0,.25);
    }
    .toggle-switch input:checked + .track{background:#bada27}
    .toggle-switch input:checked + .track .thumb{transform:translateX(20px)}

    /* info-hover tooltip (чёрное облачко), поверх всего */
    .tt{position:relative;display:inline-flex;z-index:60}
    .tt .bubble{
      display:none;position:absolute;right:0;top:120%;
      background:#101827;color:#fff;border-radius:12px;padding:10px 12px;
      font-size:13px;line-height:1.35;max-width:260px;min-width:240px;
      box-shadow:0 12px 30px rgba(0,0,0,.25);z-index:60
    }
    .tt:hover .bubble{display:block}
    .tt .bubble:after{
      content:"";position:absolute;right:16px;top:-8px;border:8px solid transparent;border-bottom-color:#101827
    }

    /* RTE */
    .rte{min-height:130px;outline:none}
    .rte[contenteditable="true"]{cursor:text}
    .rte:empty:before{content:attr(data-ph);color:#9ca3af}
    .no-resize{resize:none}

    /* dropdown / selects */
    .menu{box-shadow:0 8px 24px rgba(17,24,39,.12)}
    .disabled{opacity:.6;pointer-events:none}
    .rating i{width:14px;height:14px;border-radius:9999px;border:2px solid #d1d5db;display:inline-block}
    .rating i.active{background:#bada27;border-color:#bada27}
    .chip{display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:9999px;background:#f6f7fb;border:1px solid #e6e7eb}

    /* radio dot для rich single-select */
    .radio-dot{width:18px;height:18px;border:2px solid #d1d5db;border-radius:9999px;position:relative;flex:none}
    .radio-dot.active::after{content:"";position:absolute;inset:3px;border-radius:9999px;background:#bada27}
    .opt-row{display:flex;gap:12px;padding:10px;border-radius:12px}
    .opt-row:hover{background:#f9fafb}
    .opt-title{font-weight:600;color:#111827}
    .opt-desc{font-size:13px;line-height:1.35;color:#6b7280;margin-top:2px}

    /* плитки загрузки фото */
    .upload-tile{
      position:relative; border:1px dashed #d1d5db; border-radius:16px;
      background:#fff; display:flex; align-items:center; justify-content:center;
      transition:background .15s ease, border-color .15s ease; overflow:hidden;
    }
    .upload-tile:hover{ background:#f1f8dd; border-color:#bada27; }
    .upload-tile::before{ content:"+"; font-size:24px; line-height:1; color:#94a3b8; }
    .upload-tile input{ display:none; }
    .upload-tile img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; border-radius:16px; }
    .upload-tile.has-image::before{ content:""; }

    /* сетка главных фото (большой + 4 меньших) */
    .photos-main-grid{ grid-template-columns: 2.25fr 1fr 1fr 1fr; }

    /* красивые чекбоксы */
    .fancy-cb{appearance:none;-webkit-appearance:none;-moz-appearance:none;
      width:18px;height:18px;border-radius:4px;border:1.5px solid #c8ced6;
      display:inline-block;position:relative;vertical-align:middle;cursor:pointer;background:#fff;transition:.15s}
    .fancy-cb:checked{background:#bada27;border-color:#bada27}
    .fancy-cb:checked:after{
      content:"";position:absolute;left:4px;top:1px;width:6px;height:10px;border:2px solid #fff;border-top:0;border-left:0;transform:rotate(45deg)
    }

    /* маска времени */
    .time-input{width:152px}
    .time-input::placeholder{color:#9ca3af}

    /* иконка i в инфоблоках */
    .tip .i-dot{display:inline-flex;align-items:center;justify-content:center;
      width:20px;height:20px;border-radius:9999px;background:#dce9a0;color:#4a5a12;
      font-weight:700;font-size:12px;margin-right:8px}
  </style>
</head>
<body class="bg-ui-bg text-ui-text antialiased">
  <main class="max-w-[1160px] mx-auto px-4 lg:px-6 py-8">
    <div class="flex items-start justify-between gap-6 mb-6">
      <h1 class="text-h1 font-semibold tracking-[-0.2px]">Создание тура</h1>
      <div class="flex items-center gap-2 text-sm text-ui-mute whitespace-nowrap">
        <svg class="w-5 h-5 opacity-70" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3l7 4v10l-7 4-7-4V7l7-4z" stroke="#6b7280" stroke-width="1.5"/><circle cx="12" cy="12" r="2.25" fill="#6b7280"/></svg>
        <span>Язык описания:</span>
        <button class="inline-flex items-center gap-1 text-ui-text font-medium px-2 py-1 rounded-md hover:bg-gray-100">
          Русский
          <svg class="w-4 h-4 opacity-70" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>
    </div>

    <div class="flex items-start gap-8 flex-nowrap">
      <!-- MAIN -->
      <section class="flex-1 space-y-8">

        <!-- ============ ОБЩИЕ НАСТРОЙКИ ============ -->
        <article id="general" class="bg-ui-card card-edge rounded-xl2 shadow-subtle">
          <header class="px-6 pt-6 pb-2">
            <h2 class="text-lg font-semibold">Общие настройки</h2>
          </header>

          <div class="px-6 pb-6 space-y-6">
            <!-- Тумблер -->
            <div class="rounded-xl2 card-edge bg-white">
              <div class="flex items-center justify-between gap-4 px-4 sm:px-5 py-3.5">
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-gray-500" viewBox="0 0 24 24" fill="none"><path d="M3 12s3.6-6 9-6 9 6 9 6-3.6 6-9 6-9-6-9-6z" stroke="#6b7280" stroke-width="1.5"/><circle cx="12" cy="12" r="2.25" fill="#6b7280"/><path d="M4 4l16 16" stroke="#6b7280" stroke-width="1.2" stroke-linecap="round"/></svg>
                  <div>
                    <div class="text-[15px] font-medium">Скрыть из каталога (доступ только по ссылке)</div>
                    <p class="text-sm text-ui-mute">Тур можно будет забронировать по ссылке, но нельзя будет найти в каталоге</p>
                  </div>
                </div>
                <label class="toggle-switch cursor-pointer select-none">
                  <input id="hideToggle" type="checkbox">
                  <span class="track"><i class="thumb"></i></span>
                </label>
              </div>
            </div>

            <!-- Название -->
            <div>
              <div class="relative">
                <input id="titleInput" maxlength="85"
                  class="w-full field-like ring-muted card-edge rounded-xl2 px-4 pr-10 py-3.5 text-15 placeholder-gray-400"
                  placeholder="Название (от 2-х слов)*">
                <span class="tt absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">
                  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6"/>
                    <path d="M12 8v5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                    <circle cx="12" cy="16" r="1" fill="currentColor"/>
                  </svg>
                  <span class="bubble">Название тура должно состоять из 2+ слов</span>
                </span>
              </div>
              <div id="titleMeta" class="hidden text-13 text-ui-mute mt-1">Слов: 0  Символов: 0 / 85</div>
            </div>

            <!-- сетка -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Доп. типы -->
              <div class="md:col-span-2">
                <div id="ms-types" class="ms"></div>
                <div id="typesSelected" class="mt-2 space-y-2"></div>
              </div>

              <!-- Страны / Регионы -->
              <div><div id="ms-countries" class="ms"></div></div>
              <div>
                <div id="ms-regions" class="ms disabled"></div>
                <div id="regionsHint" class="text-13 text-ui-mute mt-1">Выберите страну, чтобы выбрать регионы</div>
              </div>

              <!-- Стоимость -->
              <div class="relative">
                <input id="priceInput"
                  class="w-full field-like ring-muted card-edge rounded-xl2 px-4 pr-10 py-3.5 text-15 placeholder-gray-400"
                  placeholder="Стоимость индивидуального тура">
                <span class="tt absolute right-2 top-1/2 -translate-y-1/2 text-gray-400">
                  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6"/>
                    <path d="M12 8v5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                    <circle cx="12" cy="16" r="1" fill="currentColor"/>
                  </svg>
                  <span class="bubble">Предварительная стоимость за человека в любые даты по запросу</span>
                </span>
              </div>
            </div>

            <!-- Ссылка на тур на других сайтах -->
            <div class="space-y-3 pt-2">
              <div class="text-[15px] font-medium">Ссылка на тур на других сайтах</div>
              <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4">
                <input id="extLink" maxlength="250" class="flex-1 w-full field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15 placeholder-gray-400" placeholder="Вставьте ссылку*">
                <label class="inline-flex items-center gap-2 text-15 text-ui-text">
                  <input type="checkbox" class="fancy-cb">
                  <span>Тур больше нигде не размещен</span>
                </label>
              </div>
            </div>

            <!-- Старт -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div id="ms-startCity"></div>
              <div>
                <div class="text-13 text-ui-mute mb-1">Время сбора</div>
                <input id="startTime" class="time-input w-full md:w-auto field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15" placeholder="ЧЧ:ММ" inputmode="numeric" maxlength="5">
              </div>
            </div>
            <!-- Финиш -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div id="ms-finishCity"></div>
              <div>
                <div class="text-13 text-ui-mute mb-1">Время сбора</div>
                <input id="finishTime" class="time-input w-full md:w-auto field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15" placeholder="ЧЧ:ММ" inputmode="numeric" maxlength="5">
              </div>
            </div>

            <!-- Возраст -->
            <div class="bg-white rounded-xl2 card-edge p-4">
              <div class="text-[15px] font-medium mb-3">Допустимый возраст участников*</div>
              <div class="flex flex-wrap items-center gap-3">
                <input id="ageFrom" maxlength="2" inputmode="numeric" class="w-24 field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15" placeholder="От, лет">
                <span class="text-ui-mute">—</span>
                <input id="ageTo" maxlength="2" inputmode="numeric" class="w-24 field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15" placeholder="До, лет">
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="fancy-cb">
                  <span class="text-15">Возможно участие с маленькими детьми</span>
                  <span class="tt">
                    <svg class="w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6"/><path d="M12 8v5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><circle cx="12" cy="16" r="1" fill="currentColor"/></svg>
                    <span class="bubble">Программа тура удобна для родителей с детьми (1–5 лет)</span>
                  </span>
                </label>
              </div>
            </div>
          </div>
        </article>

        <!-- ============ ОПИСАНИЕ ============ -->
        <article id="description" class="bg-ui-card card-edge rounded-xl2 shadow-subtle mt-8">
          <div class="px-6 pt-6 pb-2">
            <h2 class="text-lg font-semibold">Описание</h2>
          </div>

          <div class="px-6 pb-6 space-y-8">
            <!-- Описание тура -->
            <section>
              <div class="tip rounded-xl2 px-4 py-3 text-sm mb-3 flex items-start gap-2">
                <span class="i-dot">i</span>
                <div><b>Напишите подробное описание тура</b> — рекомендуем не менее 400 символов. Чем понятнее и живее описание, тем выше вероятность, что путешественник выберет именно ваш тур.</div>
              </div>

              <div class="space-y-1">
                <div class="flex flex-wrap items-center gap-1 text-sm text-ui-text">
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-cmd="bold"><b>B</b></button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 italic" data-cmd="italic"><i>i</i></button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 underline" data-cmd="underline"><u>U</u></button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-cmd="insertUnorderedList">• Список</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-cmd="insertOrderedList">1. Список</button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-cmd="removeFormat">Очистить</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-cmd="undo">Undo</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-cmd="redo">Redo</button>
                </div>
                <div id="rte-desc" class="rte field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15 no-resize" contenteditable="true" data-ph="Введите текст..."></div>
              </div>
            </section>

            <!-- Главные впечатления -->
            <section>
              <div class="text-[15px] font-medium mb-1">Главные впечатления*</div>
              <p class="text-sm text-ui-mute mb-2">Укажите основные уникальные впечатления, которые ждут путешественника. Информация будет отображаться в карточке тура.</p>
              <div class="space-y-1">
                <div class="flex flex-wrap items-center gap-1 text-sm text-ui-text">
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-high" data-cmd="bold"><b>B</b></button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 italic" data-target="#rte-high" data-cmd="italic"><i>i</i></button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 underline" data-target="#rte-high" data-cmd="underline"><u>U</u></button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-high" data-cmd="insertUnorderedList">• Список</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-high" data-cmd="insertOrderedList">1. Список</button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-high" data-cmd="removeFormat">Очистить</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-high" data-cmd="undo">Undo</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-high" data-cmd="redo">Redo</button>
                </div>
                <div id="rte-high" class="rte field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15 no-resize" contenteditable="true" data-ph="Введите текст..."></div>
              </div>
            </section>

            <!-- Видео -->
            <section>
              <div class="text-[15px] font-medium mb-2">Ссылка на видео YouTube/Vimeo</div>
              <input maxlength="250" class="w-full field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15" placeholder="Вставьте ссылку">
            </section>

            <!-- Гид -->
            <section>
              <div class="text-[15px] font-medium mb-2">Гид*</div>
              <p class="text-sm text-ui-mute mt-3">
                Пожалуйста, указывайте актуального гида – путешественники оставляют негативные отзывы, если вместо обещанного гида видят другого.
                <button id="addGuideBtn" type="button" class="font-medium text-[#99b81b] hover:underline">Добавить нового гида</button>
              </p>
              <div class="md:w-1/2 mt-2">
                <div id="ms-guide"></div>
              </div>
            </section>
          </div>
        </article>

        <!-- ============ ДЕНЬ ЗА ДНЁМ ============ -->
        <article id="daybyday" class="bg-ui-card card-edge rounded-xl2 shadow-subtle mt-8">
          <div class="px-6 pt-6">
            <h2 class="text-lg font-semibold">День за днем</h2>
            <div class="tip rounded-xl2 px-4 py-3 text-sm mb-5 flex items-start gap-2">
              <span class="mt-0.5 inline-flex items-center justify-center w-5 h-5 rounded-full bg-[#dce9a0] text-[#4a5a12] font-bold text-xs">i</span>
              <div>Опишите подробно, как проходит каждый день тура — это поможет путешественнику лучше представить программу и принять решение о бронировании.</div>
            </div>
          </div>
          <div class="px-6 pb-6">
            <div id="days" class="divide-y divide-ui-border"></div>
            <div class="pt-4">
              <button id="addDayBtn" class="w-full inline-flex items-center justify-center gap-2 px-5 h-11 rounded-xl2 bg-brand text-white font-medium hover:bg-brandDark">
                <span>+ Добавить день</span>
              </button>
            </div>
          </div>
        </article>

        <!-- ============ УСЛОВИЯ ПРОЖИВАНИЯ ============ -->
        <article id="accommodation" class="bg-ui-card card-edge rounded-xl2 shadow-subtle mt-8">
          <header class="px-6 pt-6">
            <h2 class="text-lg font-semibold">Условия проживания</h2>
            <p class="text-sm text-ui-mute mt-1">
              Расскажите, какие условия ждут путешественников. Советуем добавить фотографии – для более чем 70% путешественников это важно при выборе тура.
            </p>
          </header>

          <div class="px-6 pb-6 mt-4 space-y-6">
            <!-- УРОВНИ КОМФОРТА -->
            <section>
              <div id="comfortSelect"></div>
            </section>

            <div class="border-t border-ui-border"></div>

            <!-- ОПИСАНИЕ ЖИЛЬЯ -->
            <section class="space-y-3">
              <div id="ms-stayType"></div>

              <div class="relative">
                <input id="placeName" maxlength="240" class="w-full field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15 placeholder-gray-400" placeholder="Название места*">
                <div class="text-13 text-ui-mute mt-1 text-right">Символов: <span id="placeNameCnt">0</span> / 240</div>
              </div>

              <div id="ms-roomVariants"></div>

              <div class="tip rounded-xl2 px-4 py-3 text-sm">
                <span class="i-dot">i</span>
                Если вы хотите добавить доплату за 1-местное размещение или другие услуги, это можно сделать в разделе «Что включено‎». Можете упомянуть этот момент в описании жилья.
              </div>

              <div class="flex items-center gap-4 pt-1">
                <button id="accAddPhotos" type="button" class="h-10 px-4 rounded-xl2 bg-brand text-white font-medium hover:bg-brandDark">Добавить фото</button>
                <input id="accPhotoInput" type="file" class="hidden" accept="image/*" multiple>
                <div class="text-13 text-ui-mute">Добавьте до 20 фото в формате JPG, JPEG, PNG, WEBP</div>
              </div>
            </section>
          </div>
        </article>

        <!-- ============ ВАЖНАЯ ИНФОРМАЦИЯ ============ -->
        <article id="important" class="bg-ui-card card-edge rounded-xl2 shadow-subtle mt-8">
          <header class="px-6 pt-6 pb-2">
            <h2 class="text-lg font-semibold">Важная информация</h2>
          </header>

          <div class="px-6 pb-6 space-y-6">
            <!-- чекбокс: список вещей -->
            <div class="space-y-2">
              <label class="flex items-center gap-2 text-15">
                <input id="cbItems" type="checkbox" class="fancy-cb">
                <span>В этом туре нужен список вещей</span>
              </label>

              <div id="itemsWrap" class="hidden">
                <textarea id="itemsList" maxlength="6000" class="w-full h-36 no-resize field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15" placeholder="Список вещей, которые нужно взять с собой"></textarea>
                <div class="text-13 text-ui-mute mt-1"><span id="itemsCount">0</span> / 6000</div>
              </div>
            </div>

            <!-- чекбокс: информация о визах -->
            <div class="space-y-2">
              <label class="flex items-center gap-2 text-15">
                <input id="cbVisa" type="checkbox" class="fancy-cb">
                <span>Информация о визах</span>
              </label>

              <div id="visaWrap" class="hidden">
                <div class="space-y-1">
                  <div class="flex flex-wrap items-center gap-1 text-sm text-ui-text">
                    <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-visa" data-cmd="bold"><b>B</b></button>
                    <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 italic" data-target="#rte-visa" data-cmd="italic"><i>i</i></button>
                    <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 underline" data-target="#rte-visa" data-cmd="underline"><u>U</u></button>
                    <span class="mx-2 w-px h-4 bg-gray-300"></span>
                    <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-visa" data-cmd="insertUnorderedList">• Список</button>
                    <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-visa" data-cmd="insertOrderedList">1. Список</button>
                    <span class="mx-2 w-px h-4 bg-gray-300"></span>
                    <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-visa" data-cmd="removeFormat">Очистить</button>
                    <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-visa" data-cmd="undo">Undo</button>
                    <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-visa" data-cmd="redo">Redo</button>
                  </div>
                  <div id="rte-visa" data-max="6000" class="rte field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15 no-resize" contenteditable="true" data-ph="Опишите визовые требования..."></div>
                  <div class="text-13 text-ui-mute mt-1"><span id="visaCount">0</span> / 6000</div>
                </div>
              </div>
            </div>

            <!-- Пожелания / требования -->
            <section>
              <div class="text-[15px] font-medium mb-1">Пожелания или требования к участникам</div>
              <div class="space-y-1">
                <div class="flex flex-wrap items-center gap-1 text-sm text-ui-text">
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-wishes" data-cmd="bold"><b>B</b></button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 italic" data-target="#rte-wishes" data-cmd="italic"><i>i</i></button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 underline" data-target="#rte-wishes" data-cmd="underline"><u>U</u></button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-wishes" data-cmd="insertUnorderedList">• Список</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-wishes" data-cmd="insertOrderedList">1. Список</button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-wishes" data-cmd="removeFormat">Очистить</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-wishes" data-cmd="undo">Undo</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-wishes" data-cmd="redo">Redo</button>
                </div>
                <div id="rte-wishes" data-max="6000" class="rte field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15 no-resize" contenteditable="true" data-ph="Добавьте текст..."></div>
                <div class="text-13 text-ui-mute mt-1"><span id="wishesCount">0</span> / 6000</div>
              </div>
            </section>

            <!-- Рекомендации для покупки билетов -->
            <section>
              <div class="text-[15px] font-medium mb-1">Рекомендации для покупки билетов</div>
              <textarea id="ticketsAdvice" maxlength="6000" class="w-full h-28 no-resize field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15" placeholder="Например, где купить авиа или ж/д билеты и какие тонкости нужно знать"></textarea>
              <div class="text-13 text-ui-mute mt-1"><span id="ticketsCount">0</span> / 6000</div>
            </section>

            <!-- Комментарий организатора -->
            <section>
              <div class="text-[15px] font-medium mb-1">Комментарий организатора</div>
              <div class="space-y-1">
                <div class="flex flex-wrap items-center gap-1 text-sm text-ui-text">
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-org" data-cmd="bold"><b>B</b></button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 italic" data-target="#rte-org" data-cmd="italic"><i>i</i></button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100 underline" data-target="#rte-org" data-cmd="underline"><u>U</u></button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-org" data-cmd="insertUnorderedList">• Список</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-org" data-cmd="insertOrderedList">1. Список</button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-org" data-cmd="removeFormat">Очистить</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-org" data-cmd="undo">Undo</button>
                  <button class="btnRte px-2 py-1 rounded hover:bg-gray-100" data-target="#rte-org" data-cmd="redo">Redo</button>
                </div>
                <div id="rte-org" data-max="6000" class="rte field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15 no-resize" contenteditable="true" data-ph="Добавьте текст..."></div>
                <div class="text-13 text-ui-mute mt-1"><span id="orgCount">0</span> / 6000</div>
              </div>
            </section>
          </div>
        </article>

        <!-- ============ ФОТОГРАФИИ ============ -->
        <article id="photos" class="bg-ui-card card-edge rounded-xl2 shadow-subtle mt-8">
          <header class="px-6 pt-6 pb-2">
            <h2 class="text-lg font-semibold">Фотографии <span class="text-red-500">*</span></h2>
          </header>

          <div class="px-6 pb-6 space-y-5">
            <!-- верхняя панель -->
            <div class="flex flex-col sm:flex-row sm:items-center gap-4">
              <button id="photosAddBtn" class="h-10 px-4 rounded-xl2 bg-brand text-white font-medium hover:bg-brandDark">Добавить фото</button>
              <div class="text-sm text-ui-mute leading-snug">
                Добавьте в галерею минимум 7 фото, JPG, JPEG, PNG, WEBP.<br>
                Мин. размер 1024×768. Загружайте до 20 фотографий одновременно
              </div>
            </div>

            <!-- подсказка -->
            <div class="tip rounded-xl2 px-4 py-3 text-sm">
              <span class="i-dot">i</span>
              Мы рекомендуем загружать 20 фотографий, туры с таким количеством фотографий бронируются чаще.
            </div>

            <!-- 5 плиток: 1 большая + 4 малых -->
            <div id="photosGridMain" class="grid photos-main-grid gap-3">
              <button type="button" class="upload-tile col-span-2 row-span-2 aspect-[16/10]" data-group="main"></button>
              <button type="button" class="upload-tile aspect-square" data-group="main"></button>
              <button type="button" class="upload-tile aspect-square" data-group="main"></button>
              <button type="button" class="upload-tile aspect-square" data-group="main"></button>
              <button type="button" class="upload-tile aspect-square" data-group="main"></button>
            </div>

            <!-- Остальные фото -->
            <div class="pt-2">
              <div class="text-[15px] font-medium mb-2">Остальные фото в галерее</div>
              <div id="photosGridMore" class="grid grid-cols-4 gap-3">
                <button type="button" class="upload-tile aspect-[4/3]" data-group="more"></button>
                <button type="button" class="upload-tile aspect-[4/3]" data-group="more"></button>
                <button type="button" class="upload-tile aspect-[4/3]" data-group="more"></button>
                <button type="button" class="upload-tile aspect-[4/3]" data-group="more"></button>
              </div>
            </div>

            <!-- чекбокс + модалка -->
            <div class="pt-2">
              <label class="flex items-start gap-3 text-sm leading-snug">
                <input id="photoCopyright" type="checkbox" class="fancy-cb mt-0.5">
                <span>
                  Загружая фотографии, вы подтверждаете, что изображения сделаны вами, взяты с согласия автора или из легальных
                  источников, таких как Foter, FreePhotosBank, Pexels, Public Domain Pictures и Unsplash, и не нарушают права
                  третьих лиц. При нарушении авторских прав вы соглашаетесь оплатить штраф, который может составлять в среднем от
                  10&nbsp;000 рублей за каждое фото.
                  <button id="legalMoreBtn" type="button" class="font-medium text-brand hover:text-brandDark underline">Читать подробнее</button>
                </span>
              </label>
            </div>
          </div>
        </article>

      </section>

      <!-- RIGHT NAV -->
      <aside class="w-[240px] shrink-0 sticky top-6 hidden lg:block">
        <nav class="bg-ui-card card-edge rounded-xl2 shadow-subtle">
          <ol id="rightNav" class="py-3">
            <li><a href="#general" class="block px-4 py-2.5 text-15 hover:bg-gray-50">Общие настройки</a></li>
            <li><a href="#description" class="block px-4 py-2.5 text-15 hover:bg-gray-50">Описание</a></li>
            <li><a href="#daybyday" class="block px-4 py-2.5 text-15 hover:bg-gray-50">День за днем</a></li>
            <li><a href="#accommodation" class="block px-4 py-2.5 text-15 hover:bg-gray-50">Проживание</a></li>
            <li><a href="#important" class="block px-4 py-2.5 text-15 hover:bg-gray-50">Важная информация</a></li>
            <li><a href="#photos" class="block px-4 py-2.5 text-15 hover:bg-gray-50">Фото</a></li>
          </ol>
        </nav>
      </aside>
    </div>
  </main>

  <!-- MODAL: Добавить члена команды -->
  <div id="guideModal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative bg-white rounded-2xl shadow-subtle w-[540px] max-w-[92vw] p-5">
      <div class="flex items-start justify-between mb-3">
        <h3 class="text-lg font-semibold">Добавить члена команды</h3>
        <button id="gmClose" class="text-2xl leading-none text-gray-500 hover:text-gray-800">×</button>
      </div>

      <input id="gmFile" type="file" accept="image/*" class="hidden">
      <div class="grid grid-cols-3 gap-4">
        <div class="col-span-1">
          <button id="gmUpload" type="button" class="aspect-[1/1] border border-dashed border-gray-300 rounded-xl2 flex items-center justify-center text-sm text-ui-mute w-full">
            <div class="text-center space-y-1">
              <svg class="mx-auto w-7 h-7 opacity-70" viewBox="0 0 24 24" fill="none"><path d="M4 12v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="1.5"/><path d="M12 3v12M6 9h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
              <div>Загрузить фото</div>
            </div>
          </button>
        </div>
        <div class="col-span-2">
          <div class="text-sm text-ui-mute mb-2">Так все увидят ваше фото:</div>
          <div class="w-14 h-14 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 overflow-hidden">
            <img id="gmAvatar" alt="" class="w-full h-full object-cover hidden">
            <svg id="gmAvatarPh" class="w-8 h-8" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="3.5" fill="currentColor"/><path d="M4 21c1.7-4.5 5.1-6.5 8-6.5s6.3 2 8 6.5" stroke="currentColor" stroke-width="1.5" fill="none"/></svg>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-3 mt-4">
        <input id="gmName" class="field-like ring-muted card-edge rounded-xl2 px-3 py-2.5 text-15" placeholder="Имя*">
        <input id="gmSurname" class="field-like ring-muted card-edge rounded-xl2 px-3 py-2.5 text-15" placeholder="Фамилия*">
      </div>

      <div class="relative mt-3">
        <div class="tt absolute right-2 top-2">
          <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-800 text-white text-sm">i</span>
          <span class="bubble">Советуем делать описание простым и коротким</span>
        </div>
        <textarea id="gmAbout" maxlength="300" class="w-full h-28 no-resize field-like ring-muted card-edge rounded-xl2 px-3 py-3 text-15" placeholder="Расскажите о члене команды*"></textarea>
        <div class="text-13 text-ui-mute mt-1 text-right">Символов: <span id="gmCount">0</span> / 300</div>
      </div>

      <input id="gmEmail" type="email" class="w-full field-like ring-muted card-edge rounded-xl2 px-3 py-2.5 text-15 mt-2" placeholder="Email (не обязательно)">

      <div class="mt-4 flex justify-end">
        <button id="gmSave" class="h-11 px-6 rounded-xl2 bg-brand text-white font-medium hover:bg-brandDark">Сохранить</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Правовая информация по фото -->
  <div id="legalModal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative bg-white rounded-2xl shadow-subtle w-[640px] max-w-[92vw] p-5">
      <div class="flex items-start justify-between mb-2">
        <h3 class="text-lg font-semibold">Использование чужих фото</h3>
        <button id="legalClose" class="text-2xl leading-none text-gray-500 hover:text-gray-800">×</button>
      </div>

      <div class="space-y-4 text-[15px] text-ui-text">
        <section>
          <div class="font-medium mb-1">Что нужно знать об авторском праве</div>
          <p>У всех фото и видео есть автор, которому принадлежат права на созданный им объект. Для любого использования
            объекта нужно разрешение автора — в противном случае он может подать в суд, и придётся заплатить крупный штраф,
            который может составлять в среднем от 10&nbsp;000 рублей за каждое фото.</p>
        </section>
        <section>
          <div class="font-medium mb-1">Как узнать, можно ли использовать контент</div>
          <p>Даже если автор не указан, это не значит, что его не существует, и оно не защищено авторским правом. Если вы
            укажете автора при публикации, это всё равно не будет нарушением закона — нужно иметь его разрешение.</p>
        </section>
        <section>
          <div class="font-medium mb-1">Откуда брать фотографии</div>
          <p>Возьмите согласие владельца или используйте бесплатные фотостоки: Foter, FreePhotosBank, Pexels, Public Domain
            Pictures, Unsplash.</p>
        </section>
      </div>

      <div class="mt-5 flex justify-end">
        <button id="legalOk" class="h-11 px-6 rounded-xl2 bg-brand text-white font-medium hover:bg-brandDark">Закрыть</button>
      </div>
    </div>
  </div>

  <script>
    /* ===== helpers ===== */
    const qs = (s, el=document)=>el.querySelector(s);
    const qsa = (s, el=document)=>[...el.querySelectorAll(s)];
    const outside = (el, cb)=>{document.addEventListener('click', (e)=>{ if(!el.contains(e.target)) cb(e); });};

    /* ===== title counters ===== */
    const titleInput = qs('#titleInput'), titleMeta = qs('#titleMeta');
    const countWords = s => (s.trim().match(/[^\s]+/g) || []).length;
    titleInput.addEventListener('focus', ()=>titleMeta.classList.remove('hidden'));
    const updateTitleMeta = ()=>{ titleMeta.textContent = `Слов: ${countWords(titleInput.value)}  Символов: ${titleInput.value.length} / 85`; };
    titleInput.addEventListener('input', updateTitleMeta); updateTitleMeta();

    /* ===== age numeric ===== */
    ['#ageFrom','#ageTo'].forEach(id=>{
      qs(id).addEventListener('input', e=>{
        e.target.value = e.target.value.replace(/\D/g,'').slice(0,2);
      });
    });

    /* ===== RTE toolbar (общая) ===== */
    function bindRTEFocus(container){ container?.addEventListener('click', ()=>container.focus()); }
    bindRTEFocus(qs('#rte-desc'));
    bindRTEFocus(qs('#rte-high'));

    qsa('.btnRte').forEach(btn=>{
      if(btn.dataset.__bound) return;
      btn.dataset.__bound = '1';
      btn.addEventListener('click', ()=>{
        const target = btn.dataset.target ? qs(btn.dataset.target) : qs('#rte-desc');
        if(!target) return;
        target.focus();
        document.execCommand(btn.dataset.cmd,false,null);
      });
    });

    /* ===== Generic MultiSelect ===== */
    function MultiSelect(root, {placeholder, options=[], multiple=true, withRating=false, showSelectedBelow=false, disabled=false, onChange=null, single=false}) {
      this.root = root;
      this.multiple = multiple;
      this.single = single;
      this.withRating = withRating;
      this.showSelectedBelow = showSelectedBelow;
      this.onChange = onChange;
      this.disabled = disabled;
      this.placeholder = placeholder;
      this.state = {};
      this.setDisabled = (v)=>{ this.disabled = v; this.root.classList.toggle('disabled', v); };
      this.setOptions = (opts)=>{ options = opts; this.state = {}; this.render(); };
      this.getSelected = ()=>Object.entries(this.state).filter(([k,v])=>v.checked).map(([k,v])=>({value:k, rating:v.rating||0,label:options.find(o=>o.value===k)?.label||k}));
      this.render = ()=>{
        this.root.innerHTML = `
          <div class="relative">
            <button type="button" class="w-full field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-left flex items-center justify-between">
              <span class="text-15 text-gray-900 truncate">${this.placeholder}</span>
              <svg class="w-5 h-5 text-gray-400 ml-2" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="1.8"/></svg>
            </button>
            <div class="menu hidden absolute left-0 right-0 mt-1 bg-white rounded-xl2 card-edge max-h-72 overflow-auto z-20">
              ${this.multiple && !this.single ? `<div class="sticky top-0 bg-white p-2 border-b"><input class="w-full field-like ring-muted card-edge rounded-lg px-3 py-2 text-sm" placeholder=""></div>`:''}
              <ul class="p-2 space-y-1"></ul>
            </div>
          </div>`;
        this.input = this.root.querySelector('button');
        this.menu = this.root.querySelector('.menu');
        const ul = this.root.querySelector('ul');
        ul.innerHTML = '';
        options.forEach(opt=>{
          const li = document.createElement('li');
          li.className = 'flex items-center justify-between px-2 py-1.5 rounded hover:bg-gray-50';
          li.dataset.value = opt.value;
          li.innerHTML = `
            <label class="flex items-center gap-2 cursor-pointer">
              ${this.single ? '' : `<input type="checkbox" class="w-4 h-4 rounded border-gray-300 text-brand">`}
              <span>${opt.label}</span>
            </label>
            ${this.withRating ? `<div class="rating flex items-center gap-1">${[1,2,3,4,5].map(i=>`<i data-rate="${i}"></i>`).join('')}</div>`:''}
          `;
          ul.appendChild(li);
        });

        this.input.onclick = ()=>{ if(!this.disabled) this.menu.classList.toggle('hidden'); };
        outside(this.root, ()=>this.menu.classList.add('hidden'));

        ul.addEventListener('click', (e)=>{
          const li = e.target.closest('li'); if(!li) return;
          const value = li.dataset.value;
          if(this.withRating && e.target.matches('.rating i')){
            const r = +e.target.dataset.rate;
            this.state[value] = this.state[value] || {checked: true, rating: r};
            this.state[value].rating = r;
            li.querySelectorAll('.rating i').forEach(i=>i.classList.toggle('active', +i.dataset.rate <= r));
            if(this.single){ this.menu.classList.add('hidden'); }
            this.onChange && this.onChange(this.getSelected());
            this.renderSelectedBelow();
            return;
          }
          if(this.single){
            this.state = {[value]: {checked:true}};
            this.menu.classList.add('hidden');
            this.input.querySelector('span').textContent = options.find(o=>o.value===value)?.label || this.placeholder;
          } else {
            const cb = li.querySelector('input[type="checkbox"]');
            if(e.target!==cb) cb.checked = !cb.checked;
            const checked = cb.checked;
            this.state[value] = this.state[value] || {};
            this.state[value].checked = checked;
          }
          this.onChange && this.onChange(this.getSelected());
          this.renderSelectedBelow();
        });
      };
      this.renderSelectedBelow = ()=>{
        if(!this.showSelectedBelow) return;
        const wrapId = this.root.id === 'ms-types' ? '#typesSelected' : null;
        if(!wrapId) return;
        const wrap = qs(wrapId);
        wrap.innerHTML = '';
        this.getSelected().forEach(it=>{
          const chip = document.createElement('div');
          chip.className = 'chip justify-between';
          chip.innerHTML = `<span>${it.label}</span>
            <span class="rating ml-2">${[1,2,3,4,5].map(i=>`<i class="${i<= (it.rating||0)?'active':''}"></i>`).join('')}</span>`;
          wrap.appendChild(chip);
        });
      };
      this.render();
    }

    /* ===== SingleSelectRich (радио + описание) ===== */
    function SingleSelectRich(root, {placeholder, options=[], onChange=null}) {
      this.root = root; this.placeholder = placeholder; this.options = options; this.value = null; this.onChange = onChange;
      this.render = ()=>{
        this.root.innerHTML = `
          <div class="relative">
            <button type="button" class="w-full field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-left flex items-center justify-between">
              <span class="text-15 text-gray-900 truncate">${this.placeholder}</span>
              <svg class="w-5 h-5 text-gray-400 ml-2" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="1.8"/></svg>
            </button>
            <div class="menu hidden absolute left-0 right-0 mt-1 bg-white rounded-xl2 card-edge max-h-80 overflow-auto z-30">
              <ul class="p-2">
                ${this.options.map(o=>`
                  <li class="px-2 py-2 rounded hover:bg-gray-50 cursor-pointer flex items-start gap-3" data-value="${o.value}">
                    <span class="radio-dot mt-0.5"></span>
                    <span>
                      <div class="font-medium">${o.label}</div>
                      ${o.desc ? `<div class="text-13 text-ui-mute">${o.desc}</div>`:''}
                    </span>
                  </li>`).join('')}
              </ul>
            </div>
          </div>`;
        const btn = this.root.querySelector('button'); const menu = this.root.querySelector('.menu');
        const labelSpan = btn.querySelector('span');
        btn.onclick = ()=>menu.classList.toggle('hidden');
        outside(this.root, ()=>menu.classList.add('hidden'));
        const apply = (val)=>{
          this.value = val;
          this.root.querySelectorAll('li').forEach(li=>{
            li.querySelector('.radio-dot')?.classList.toggle('active', li.dataset.value===this.value);
          });
          const found = this.options.find(o=>o.value===this.value);
          labelSpan.textContent = found ? found.label : this.placeholder;
          this.onChange && this.onChange(this.value);
        };
        this.root.querySelector('ul').addEventListener('click', e=>{
          const li = e.target.closest('li[data-value]'); if(!li) return;
          apply(li.dataset.value); menu.classList.add('hidden');
        });
      };
      this.getValue = ()=>this.value;
      this.render();
    }

    /* ===== init selects (types / countries / regions / start/finish / guide) ===== */
    const msTypes = new MultiSelect(qs('#ms-types'), {
      placeholder:'Дополнительные типы (до 3-х)',
      options: [
        {value:'Автотур',label:'Автотур'},{value:'Автобусный',label:'Автобусный'},{value:'Арт тур',label:'Арт тур'},
        {value:'Блог-тур',label:'Блог-тур'},{value:'Велотур',label:'Велотур'},{value:'Винный',label:'Винный'}
      ],
      multiple:true, withRating:true, showSelectedBelow:true
    });

    const countriesOptions = [
      'Абхазия','Австралия','Австрия','Азербайджан','Албания','Алжир',
      'Ангола','Андорра','Антарктида','Антигуа и Барбуда','Аргентина','Армения'
    ].map(v=>({value:v,label:v}));

    const msCountries = new MultiSelect(qs('#ms-countries'), {
      placeholder:'Страна(ы) тура*', options:countriesOptions, multiple:true,
      onChange: (sel)=>{
        const any = sel.length>0;
        msRegions.setDisabled(!any);
        qs('#regionsHint').style.display = any ? 'none' : '';
        if(any){
          const map = {
            'Австралия':['Новый Южный Уэльс','Квинсленд','Виктория'],
            'Аргентина':['Буэнос-Айрес','Мендоса','Санта-Крус'],
            'Австрия':['Тироль','Зальцбург','Каринтия'],
            'Армения':['Ереван','Тавуш','Сюник'],
            'Абхазия':['Сухум','Гагра','Новый Афон'],
            'Андорра':['Андорра-ла-Велья','Энкамп'],
            'Албания':['Тирана','Саранда'],
            'Алжир':['Алжир','Оран'],
            'Азербайджан':['Баку','Гянджа'],
            'Ангола':['Луанда','Бенгела'],
            'Антарктида':['Станция Восток','Мирный'],
            'Антигуа и Барбуда':['Сент-Джонс','Барбуда']
          };
          const opts = [];
          sel.forEach(c=>{ (map[c.value]||['Центр','Север','Юг']).forEach(r=>opts.push({value:`${c.value}:${r}`,label:`${r}`})); });
          msRegions.setOptions(opts);
        } else {
          msRegions.setOptions([]);
        }
      }
    });

    const msRegions = new MultiSelect(qs('#ms-regions'), { placeholder:'Регионы', options:[], multiple:true, disabled:true });
    const msStart   = new MultiSelect(qs('#ms-startCity'), { placeholder:'Старт (город)*', options:['Москва (Шереметьево)','Санкт-Петербург','Сочи','Казань','Алматы','Тбилиси','Ереван','Рим (Колизей)'].map(v=>({value:v,label:v})), multiple:false, single:true });
    const msFinish  = new MultiSelect(qs('#ms-finishCity'), { placeholder:'Финиш (город)*', options:['Москва','Сочи','Минск','Анкара','Барселона','Стамбул','Баку'].map(v=>({value:v,label:v})), multiple:false, single:true });

    // Guide select + modal
    const msGuide = new MultiSelect(qs('#ms-guide'), {
      placeholder:'Выберите гида*',
      options:[{value:'batyr',label:'Рахманов Батыр'},{value:'add',label:'Добавить нового гида'}],
      multiple:false, single:true,
      onChange: (sel)=>{ if(sel[0]?.value==='add') openGuideModal(); }
    });

    /* ===== Guide modal ===== */
    const gm = qs('#guideModal');
    function openGuideModal(){ gm.classList.remove('hidden'); gm.classList.add('flex'); }
    function closeGuideModal(){ gm.classList.add('hidden'); gm.classList.remove('flex'); }
    qs('#gmClose').onclick = closeGuideModal;
    gm.querySelector('.absolute.inset-0').onclick = closeGuideModal;

    const gmAbout = qs('#gmAbout'), gmCount = qs('#gmCount');
    gmAbout.addEventListener('input', ()=>gmCount.textContent = gmAbout.value.length);

    // upload avatar
    const fileInput = qs('#gmFile'), upBtn = qs('#gmUpload'), avatar = qs('#gmAvatar'), avatarPh = qs('#gmAvatarPh');
    upBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', ()=>{
      const f = fileInput.files?.[0]; if(!f) return;
      const url = URL.createObjectURL(f);
      avatar.src = url; avatar.classList.remove('hidden'); avatarPh.classList.add('hidden');
    });

    // save guide
    qs('#gmSave').onclick = ()=>{
      const name = qs('#gmName').value.trim();
      const sur  = qs('#gmSurname').value.trim();
      if(!name || !sur){ alert('Имя и Фамилия обязательны'); return; }
      const label = `${sur} ${name}`;
      const newVal = 'guide_' + Date.now();
      const prev = [{value:'batyr',label:'Рахманов Батыр'},{value:'add',label:'Добавить нового гида'}];
      prev.splice(1,0,{value:newVal,label});
      msGuide.setOptions(prev);
      msGuide.state = {[newVal]:{checked:true}};
      msGuide.onChange && msGuide.onChange(msGuide.getSelected());
      closeGuideModal();
    };
    // кнопка "Добавить нового гида" из текста
    qs('#addGuideBtn')?.addEventListener('click', openGuideModal);

    /* ===== маска времени ===== */
    function bindTimeMask(el){
      el.addEventListener('input', (e)=>{
        let v = e.target.value.replace(/\D/g,'').slice(0,4);
        if(v.length>=3) v = v.slice(0,2)+':'+v.slice(2);
        e.target.value = v;
      });
      el.addEventListener('blur', (e)=>{
        const m = e.target.value.match(/^(\d{1,2}):(\d{2})$/);
        if(!m){ e.target.value=''; return; }
        let h = +m[1], mi = +m[2];
        if(h>23) h=23; if(mi>59) mi=59;
        e.target.value = String(h).padStart(2,'0')+':'+String(mi).padStart(2,'0');
      });
    }
    ['#startTime','#finishTime'].forEach(sel=>{ const el = qs(sel); if(el) bindTimeMask(el); });

    /* ===== Comfort select ===== */
    new SingleSelectRich(qs('#comfortSelect'), {
      placeholder:'Уровни комфорта*',
      options:[
        {value:'high',   label:'Высокий',   desc:'Проживание в отелях 3* и выше / домах/квартирах. Для тех, кому важен комфорт во время поездки'},
        {value:'basic',  label:'Базовый',   desc:'Палатки/кемпинг. Возможны отсутствие горячей воды и привычного санузла'},
        {value:'simple', label:'Простой',   desc:'Гостевые дома или отели 1*. Удобства могут быть на этаже. Аутентичный опыт без роскоши'},
        {value:'mid',    label:'Средний',   desc:'Отели 1*–2*, коттеджи, апартаменты. Для тех, кто готов к разнообразному опыту'},
        {value:'uniq',   label:'Уникальный',desc:'Отели 4*–5*, глэмпинг, бутик-отели с экстра-обслуживанием'}
      ]
    });

    // stay type / variants
    new MultiSelect(qs('#ms-stayType'), {
      placeholder:'Тип проживания*',
      options:[
        'Отели (1–5★)','Апартаменты','Гостевые домики','Дома на колесах','Глэмпинг','Хостел','Кемпинг'
      ].map(v=>({value:v,label:v})),
      multiple:false, single:true
    });
    new MultiSelect(qs('#ms-roomVariants'), {
      placeholder:'Варианты размещения*',
      options:[
        '1-местный номер','2-местный номер','3-местный номер','4-местный номер'
      ].map(v=>({value:v,label:v})),
      multiple:false, single:true
    });

    // счетчик названия места
    const placeName = qs('#placeName'), placeNameCnt = qs('#placeNameCnt');
    placeName?.addEventListener('input', ()=>placeNameCnt.textContent = placeName.value.length);

    // кнопка доб. фото в проживании
    qs('#accAddPhotos')?.addEventListener('click', ()=> qs('#accPhotoInput').click());

    /* ===== Important toggles ===== */
    const cbItems = qs('#cbItems'), itemsWrap = qs('#itemsWrap'), itemsList = qs('#itemsList'), itemsCount = qs('#itemsCount');
    cbItems?.addEventListener('change', ()=> itemsWrap.classList.toggle('hidden', !cbItems.checked));
    itemsList?.addEventListener('input', ()=> itemsCount.textContent = itemsList.value.length);
    itemsCount && (itemsCount.textContent = (itemsList?.value.length || 0));

    const cbVisa = qs('#cbVisa'), visaWrap = qs('#visaWrap'), rteVisa = qs('#rte-visa'), visaCount = qs('#visaCount');
    cbVisa?.addEventListener('change', ()=> visaWrap.classList.toggle('hidden', !cbVisa.checked));

    function bindCEWithCounter(el, counterEl, max=6000){
      if(!el) return;
      const update = ()=>{
        let txt = el.innerText || '';
        if (txt.length > max) {
          el.innerText = txt.slice(0, max);
          const range = document.createRange(); range.selectNodeContents(el); range.collapse(false);
          const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);
        }
        counterEl.textContent = (el.innerText || '').length;
      };
      el.addEventListener('input', update); update();
    }
    bindCEWithCounter(rteVisa, visaCount, 6000);
    bindCEWithCounter(qs('#rte-wishes'), qs('#wishesCount'), 6000);
    bindCEWithCounter(qs('#rte-org'), qs('#orgCount'), 6000);

    // билеты
    const ticketsAdvice = qs('#ticketsAdvice'), ticketsCount = qs('#ticketsCount');
    ticketsAdvice?.addEventListener('input', ()=> ticketsCount.textContent = ticketsAdvice.value.length);
    ticketsCount && (ticketsCount.textContent = (ticketsAdvice?.value.length || 0));

    /* ===== Photos (галерея) ===== */
    function makeFileInput(accept='image/jpeg,image/png,image/webp'){ const inp=document.createElement('input'); inp.type='file'; inp.accept=accept; return inp; }
    function setTilePreview(tile, file){
      if(!file) return;
      const img = document.createElement('img'); img.src = URL.createObjectURL(file);
      tile.querySelectorAll('img').forEach(i=>i.remove());
      tile.classList.add('has-image'); tile.appendChild(img);
    }
    function bindUploadTile(tile){
      const input = makeFileInput(); tile.appendChild(input);
      tile.addEventListener('click', ()=> input.click());
      input.addEventListener('change', ()=>{ if(input.files && input.files[0]) setTilePreview(tile, input.files[0]); });
    }
    function bulkFillTiles(files){
      const tiles = [...document.querySelectorAll('#photosGridMain .upload-tile, #photosGridMore .upload-tile')];
      const empty = tiles.filter(t=>!t.classList.contains('has-image'));
      let i=0;
      for(const f of files){
        if(!empty[i]) break;
        let hidden = empty[i].querySelector('input[type="file"]');
        if(!hidden){ hidden = makeFileInput(); empty[i].appendChild(hidden); }
        setTilePreview(empty[i], f); i++;
      }
    }
    document.querySelectorAll('#photosGridMain .upload-tile, #photosGridMore .upload-tile').forEach(bindUploadTile);
    (()=>{ const btn = document.getElementById('photosAddBtn'); const hidden = makeFileInput(); hidden.multiple=true;
      btn.addEventListener('click', ()=> hidden.click());
      hidden.addEventListener('change', ()=>{ if(hidden.files?.length) bulkFillTiles(hidden.files); hidden.value=''; });
    })();
    // «невозвратный» чекбокс
    (()=>{ const cb = document.getElementById('photoCopyright'); cb.addEventListener('change', ()=>{ if(cb.checked){ cb.disabled=true; cb.classList.add('opacity-70','cursor-not-allowed'); } }); })();
    // модалка «Читать подробнее»
    (()=>{ const modal=qs('#legalModal'); const open=qs('#legalMoreBtn'); const closeEls=[qs('#legalClose'),qs('#legalOk')]; const bg=modal.querySelector('.absolute.inset-0');
      const openModal=()=>{ modal.classList.remove('hidden'); modal.classList.add('flex'); };
      const closeModal=()=>{ modal.classList.add('hidden'); modal.classList.remove('flex'); };
      open.addEventListener('click', openModal); closeEls.forEach(el=>el.addEventListener('click', closeModal)); bg.addEventListener('click', closeModal);
    })();

    /* ===== Right nav highlight ===== */
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          qsa('#rightNav a').forEach(a=>a.parentElement.classList.remove('nav-active'));
          const active = qs(`#rightNav a[href="#${e.target.id}"]`);
          if(active) active.parentElement.classList.add('nav-active');
        }
      });
    },{rootMargin:"-40% 0px -55% 0px", threshold:[0,1]});
    ['#general','#description','#daybyday','#accommodation','#important','#photos'].map(id=>qs(id)).forEach(el=>io.observe(el));

    /* ===== День за днем (финальная версия) ===== */
    (()=>{
      const root     = document.getElementById('daybyday');
      const daysWrap = root.querySelector('#days');

      const LOCATION_OPTIONS = [
        'Москва — Красная площадь','Санкт-Петербург — Невский проспект','Сочи — Ривьера',
        'Казань — Кремль','Ереван — Каскад','Тбилиси — Старый город',
        'Рим — Колизей','Париж — Эйфелева башня','Барселона — Готический квартал'
      ].map(v=>({value:v,label:v}));

      function dayTpl(n){
        return `
          <article class="day-block py-5" data-day>
            <header class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-2">
                ${n===1 ? '' : `<button type="button" data-remove-day class="text-gray-400 hover:text-gray-700 w-8 h-8 rounded-md">✕</button>`}
                <h3 class="text-[15px] font-semibold" data-day-title>День ${n}</h3>
              </div>
            </header>

            <div class="space-y-3">
              <input data-day-name maxlength="50" class="w-full field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15" placeholder="Название дня*">

              <div class="space-y-1">
                <div class="flex flex-wrap items-center gap-1 text-sm text-ui-text" data-rte-toolbar>
                  <button data-cmd="bold" type="button" class="px-2 py-1 rounded hover:bg-gray-100"><b>B</b></button>
                  <button data-cmd="italic" type="button" class="px-2 py-1 rounded hover:bg-gray-100 italic"><i>i</i></button>
                  <button data-cmd="underline" type="button" class="px-2 py-1 rounded hover:bg-gray-100 underline"><u>U</u></button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button data-cmd="insertUnorderedList" type="button" class="px-2 py-1 rounded hover:bg-gray-100">• Список</button>
                  <button data-cmd="insertOrderedList"   type="button" class="px-2 py-1 rounded hover:bg-gray-100">1. Список</button>
                  <span class="mx-2 w-px h-4 bg-gray-300"></span>
                  <button data-cmd="removeFormat" type="button" class="px-2 py-1 rounded hover:bg-gray-100">Очистить</button>
                  <button data-cmd="undo"         type="button" class="px-2 py-1 rounded hover:bg-gray-100">Undo</button>
                  <button data-cmd="redo"         type="button" class="px-2 py-1 rounded hover:bg-gray-100">Redo</button>
                </div>
                <div data-rte class="rte field-like ring-muted card-edge rounded-xl2 px-4 py-3.5 text-15 no-resize" contenteditable="true" data-ph="Добавьте описание..." maxlength="6000"></div>
                <div class="text-13 text-ui-mute"><span data-rte-count>0</span> / 6000</div>
              </div>

              <div>
                <div data-locations-wrap class="space-y-2"></div>
                <button type="button" data-add-location class="mt-2 text-brand font-medium">+ Добавить еще локацию</button>
              </div>

              <div class="tip rounded-xl2 px-4 py-3 text-sm flex items-start gap-2">
                <span class="mt-0.5 inline-flex items-center justify-center w-5 h-5 rounded-full bg-[#dce9a0] text-[#4a5a12] font-bold text-xs">i</span>
                <div>Обязательно укажите, с какой локации начинается каждый день — это помогает туру лучше отображаться при поиске и повышает его видимость.</div>
              </div>

              <div class="grid grid-cols-3 gap-3" data-photos>
                ${Array.from({length:3}).map(()=>`
                  <div class="relative">
                    <button type="button" class="photo-slot w-full aspect-[4/3] border-2 border-dashed rounded-xl2 flex items-center justify-center text-gray-400 hover:border-brand hover:bg-[#f1f8dd]">
                      <span class="text-2xl">+</span>
                    </button>
                    <input type="file" accept="image/*" class="hidden" data-photo-input>
                  </div>`).join('')}
              </div>

              <div class="tip rounded-xl2 px-4 py-3 text-sm flex items-start gap-2">
                <span class="mt-0.5 inline-flex items-center justify-center w-5 h-5 rounded-full bg-[#dce9a0] text-[#4a5a12] font-bold text-xs">i</span>
                <div>Добавьте как минимум 2 фотографии — это заметно повышает шансы на бронирование.</div>
              </div>
            </div>
          </article>`;
      }

      function addLocationRow(dayEl){
        const host = qs('[data-locations-wrap]', dayEl);
        const row = document.createElement('div');
        row.className = 'mt-2'; row.dataset.locationRow = '';
        row.innerHTML = `
          <div class="relative">
            <div class="ms" data-day-location-ms></div>
            <button type="button" data-remove-location class="absolute -right-0 top-1/2 -translate-y-1/2 flex items-center justify-center w-12 h-12 rounded-xl2 bg-white card-edge text-gray-500 hover:text-red-600" aria-label="Удалить локацию">✕</button>
          </div>`;
        host.appendChild(row);
        row.__ms = new MultiSelect(qs('[data-day-location-ms]', row), { placeholder:'Введите название локации', options: LOCATION_OPTIONS, multiple:false, single:true });
      }

      function bindDay(dayEl){
        const rte = qs('[data-rte]', dayEl), count = qs('[data-rte-count]', dayEl);
        const update = ()=>{
          const len = (rte.innerText||'').length;
          if(len>6000){ rte.innerText = rte.innerText.slice(0,6000); placeCaretAtEnd(rte); }
          count.textContent = (rte.innerText||'').length;
        };
        rte.addEventListener('input', update); update();
        qs('[data-rte-toolbar]', dayEl).addEventListener('click', (e)=>{
          const btn = e.target.closest('button[data-cmd]'); if(!btn) return;
          rte.focus(); document.execCommand(btn.dataset.cmd,false,null);
        });
        addLocationRow(dayEl);
      }
      function placeCaretAtEnd(el){ const r=document.createRange(); r.selectNodeContents(el); r.collapse(false); const s=window.getSelection(); s.removeAllRanges(); s.addRange(r); }

      function renumberDays(){
        qsa('[data-day]', daysWrap).forEach((d,i)=>{
          qs('[data-day-title]', d).textContent = `День ${i+1}`;
          const del = d.querySelector('[data-remove-day]');
          if(i===0 && del) del.remove();
          if(i>0 && !del){
            const btn = document.createElement('button');
            btn.type='button'; btn.dataset.removeDay=''; btn.className='text-gray-400 hover:text-gray-700 w-8 h-8 rounded-md'; btn.textContent='✕';
            d.querySelector('header .flex.items-center.gap-2').prepend(btn);
          }
        });
      }

      function addDay(){
        const n = daysWrap.children.length + 1;
        daysWrap.insertAdjacentHTML('beforeend', dayTpl(n));
        const dayEl = daysWrap.lastElementChild;
        bindDay(dayEl);
        renumberDays();
      }

      root.addEventListener('click', (e)=>{
        if (e.target.closest('#addDayBtn')) addDay();
        const rmDay = e.target.closest('[data-remove-day]'); if (rmDay){ rmDay.closest('[data-day]').remove(); renumberDays(); }
        const addLoc = e.target.closest('[data-add-location]'); if (addLoc){ addLocationRow(addLoc.closest('[data-day]')); }
        const rmLoc = e.target.closest('[data-remove-location]'); if (rmLoc){ rmLoc.closest('[data-location-row]')?.remove(); }
        const slot = e.target.closest('.photo-slot'); if (slot){ slot.parentElement.querySelector('[data-photo-input]').click(); }
      });
      root.addEventListener('change', (e)=>{
        if (!e.target.matches('[data-photo-input]')) return;
        const file = e.target.files?.[0]; if(!file) return;
        const url = URL.createObjectURL(file);
        const btn = e.target.closest('div.relative').querySelector('.photo-slot');
        btn.style.backgroundImage=`url('${url}')`; btn.style.backgroundSize='cover'; btn.style.backgroundPosition='center';
        btn.querySelector('span').style.opacity='0';
      });

      // первый день
      addDay();
    })();
  </script>
</body>
</html>



